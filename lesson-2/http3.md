# HTTP/3

Протокол передачи гипертекста (HTTP) — это протокол передачи данных, который является основой Всемирной паутины.
Первоначально выпущенный в 1991 году (HTTP/0.9), он прошел через несколько небольших ревизий, а также через крупную
ревизию HTTP/2, которая была опубликована в 2015 году. HTTP/3это следующая крупная версия протокола, которая будет
разработана и выпущена.

Этот крупный пересмотр стандарта изменяет базовый сетевой протокол транспортного уровня с протокола управления
передачей (TCP) на QUIC («Быстрые подключения к Интернету по протоколу UDP»). Первоначальное предложение называлось
«Семантика HTTP/2 с использованием транспортного протокола QUIC», затем «Протокол передачи гипертекста (HTTP) через
QUIC» и, наконец, HTTP/3.

## Статус

В настоящее время спецификация для HTTP/3 все еще является проектом IETF. Однако он уже поддерживается большинством
веб-браузеров и работает на миллионах веб-сайтов.

## Протокол QUIC и ограничения TCP

Протокол Quick UDP Internet Connections (QUIC) был разработан Google и после SPDY, который стал HTTP/2, это следующая
экспериментальная технология от Google, которая стала стандартом. Это мультиплексный алгоритм связи, который построен
поверх протокола UDP.

Первоначальной целью QUIC было предложить альтернативу HTTP/2, используя TCP для передачи данных и TLS для безопасности.
TCP изначально не был создан с упором на эффективность. Например, инициирование HTTP-соединения требует полного сетевого
кругового обхода, чтобы гарантировать, что клиент и сервер доступны и готовы к обмену данными. В зависимости от
расстояния между клиентом и сервером, а также количества посредников, задержка и результирующее время передачи
становятся более заметными.

Другая распространенная проблема — блокировка начала очереди, которую предполагалось устранить с помощью конвейерного
подхода, реализованного для HTTP/2. Конвейерная обработка позволяет выполнять несколько HTTP-запросов с использованием
одного и того же TCP -соединения, но этого было недостаточно из-за того, как TCP передает данные. TCP воспринимает и
работает с данными как с однобайтовым потоком, даже в случаях, когда одновременно отправляются несколько
взаимоисключающих файлов. Проблема возникает, когда пакеты, содержащие данные «в начале очереди», теряются, поскольку
оставшиеся пакеты, следовательно, задерживаются до тех пор, пока не будут найдены отсутствующие.

HTTP/2 против QUIC

Ограничения TCP теоретически могут быть устранены путем обновления протокола. Однако его укрепление укреплено
существующими низкоуровневыми реализациями в операционных системах и промежуточных устройствах. Широкое развертывание
изменений в TCP просто непрактично, отчасти из-за области применения, но также и потому, что промежуточные устройства,
такие как маршрутизаторы и балансировщики нагрузки, не всегда можно так же легко обновить. Поскольку QUIC построен
поверх UDP, он не подвержен прямым ограничениям TCP.

HTTP/3по существу полагается на QUIC для безопасности и целостности данных, аутентификации одноранговых узлов и
надежной, упорядоченной доставки данных с улучшенной производительностью. Это улучшения поверх HTTP/2, которые не могут
быть легко реализованы TCP, поэтому необходимо переключить базовый протокол.

## Производительность
В контексте передачи протокола производительность измеряет скорость передачи, которая является комбинацией полосы
пропускания и задержки. Полоса пропускания относится к объему данных, которые могут быть отправлены за один раз, тогда
как задержка относится ко времени, затраченному на перемещение данных от одной конечной точки к другой. Двусторонняя
задержка — это время, необходимое для завершения полного цикла передачи по сети. Каждый посредник на пути может иметь
различные ограничения полосы пропускания, и в конечном итоге производительность ограничивается самым медленным
соединением между посредниками или посредником и конечной точкой.

Идеальная производительность достигается посредством надежной и последовательной серии соединений с высокой пропускной
способностью и низкой задержкой на протяжении всего цикла передачи данных по сети. Производительность является
критически важным показателем, поскольку она напрямую связана с потерей пакетов, что, в свою очередь, требует надежного
подхода к контролю перегрузки.

QUIC использует сжатые заголовки, как и HTTP/2. Однако QUIC использует алгоритм QPACK для сжатия заголовков, тогда как
HTTP/2 использует HPACK. Разница в том, что QPACK предназначен для работы с потоками.

В контексте загрузки ЦП QUIC занимает больше процессорного времени, чем тот же объем данных с использованием HTTP/2,
защищенного с помощью TLS. Это связано с тем, что UDP не так оптимизирован, как TCP , с точки зрения реализации. Будь то
часть операционной системы или поиск аппаратной реализации, поддержка UDP просто не так широка или развита. Однако это
то, что изменится со временем, поскольку QUIC станет более распространенным.

## Контроль за перегрузкой
TCP и QUIC используют схожие методы для контроля перегрузки и ограничения как вероятности, так и последствий потери
пакетов во время передачи. Каждый из них начинает с отправки данных с относительно низкой скоростью, а затем увеличивает
скорость по мере получения подтверждений о том, какие и сколько данных получает конечная точка. Это область активной
разработки, и в ней QUIC имеет явное преимущество.

Как упоминалось ранее, сложно развертывать обновления для TCP. Однако на этой ранней стадии реализации QUIC обычно
находятся на уровне приложений, где модификации и расширения легко внедрять и запускать в производство. Одним из таких
примеров является Sender Control of Acknowledgment Delays в расширении QUIC.

Это расширение было мотивировано тем фактом, что передачи UDP могут быть ресурсоемкими и, следовательно, более
медленными на определенных платформах. Уменьшая количество пакетов подтверждения в определенных средах, можно получить
большие преимущества с точки зрения скорости. Это расширение и другие подобные ему относительно легко реализовать в
QUIC, но значительно сложнее реализовать в TCP. Это будет способствовать улучшению контроля перегрузки и в конечном
итоге может привести к алгоритму, который работает лучше во всех случаях.

## Упрощенная настройка
QUIC не требует такого же количества сетевых циклов, как HTTP/2 с использованием TCP и TLS, что снижает накладные
расходы для каждого HTTP-соединения. Это связано с тем, что TCP не позволяет отправлять не-TCP-данные во время
первоначального рукопожатия, поэтому для TLS -соединения требуется отдельный сетевой цикл для защиты TCP -соединения.
Поскольку QUIC был разработан с учетом таких проблем безопасности, эти две операции выполняются вместе. В некоторых
случаях, в зависимости от используемой версии TLS, использование QUIC сэкономит более одного полного сетевого цикла, что
еще больше повысит производительность.

TCP против QUIC

## Возобновление сеанса
Когда HTTP-соединение установлено и защищено, разумно предположить при определенных обстоятельствах, что клиент снова
подключится в течение короткого времени. Алгоритм QUIC использует эти знания, готовясь ко второму HTTP-соединению до
того, как первое будет разорвано. Выполняя эту подготовку заранее, он экономит по крайней мере один полный сетевой цикл
при установлении нового HTTP-соединения. Это называется Zero Round Trip Time Resumption или 0-RTT.

QUIC имеет определенные ограничения при ответе на запросы 0-RTT, чтобы предотвратить определенные типы DDoS- атак. Это
регулирование данных известно как ограничение антиусиления и относится к объему данных, которые он может отправить в
ответ до проверки клиента. Ограничение установлено в три раза больше объема данных, полученных с этого адреса.

## Миграция соединения
Другим улучшением производительности, поддерживаемым протоколом QUIC, является миграция соединения, которая может
поддерживать соединение HTTP при переходе из одной сети в другую. Например, перемещение из сотовой сети в офис или домой
и присоединение к локальной сети Wi-Fi будет означать назначение нового IP-адреса. Это изменяет по крайней мере один из
параметров, составляющих 4-кортеж TCP, который представляет собой агрегацию IP-адреса клиента, исходного порта клиента,
IP-адреса сервера и порта назначения сервера. Для идентификации соединений HTTP QUIC вводит новый параметр, называемый
идентификатором соединения (CID), который не изменяется при переходе между сетями.

Технически, CID в этом контексте не является отдельным идентификатором. Вместо этого это список случайно сгенерированных
идентификаторов, известных как серверу, так и клиенту, которые идентифицируют одно и то же HTTP Connection. Каждый раз,
когда используется новая сеть, CID меняется на другой в списке. Цель этого — еще больше защитить конфиденциальность
отправителя.

Даже до QUIC был период перекрытия между первой сетью, которая сбрасывала HTTP-соединение, и второй сетью, которая
принимала управление, но переключение не всегда было прозрачным. Особенно в случае потокового аудио или видео, например,
видеоконференции, пользователь не знает о переключении сети.

Уместно отметить, что когда HTTP-соединение переносится в другую сеть, передача данных возобновляется, но протокол
должен снова проверить скорость, с которой он может безопасно продолжаться. Это означает, что алгоритм управления
перегрузкой запускается с самого начала и медленно регулирует пропускную способность, пока не достигнет оптимальной
скорости для новой сети. Соединение не будет разорвано, хотя даже при перемещении в сеть с такой же или более высокой
пропускной способностью скорость передачи данных на мгновение упадет.

По этой причине вклад миграции подключений в производительность заключается не столько в скорости в среднем случае,
сколько в предотвращении более серьезного удара из-за оттока подключений. Однако это может иметь небольшое значение,
поскольку этот тип сетевого переноса происходит не очень часто. Например, новый IP-адрес не создается при переключении
между точками доступа в ячеистой сети внутри большого офисного здания.

## Безопасность
Хотя с принятием QUIC было уделено много внимания повышению производительности, есть также преимущество с точки зрения
безопасности и конфиденциальности данных. Полезно учитывать, что безопасное HTTP-соединение (т.е. HTTPS) создается с
использованием протокола Transport Layer Security (TLS) поверх HTTP-соединения. Этот двухслойный подход применяется с
первых дней существования Интернета, когда шифрование трафика имело меньший приоритет. С QUIC безопасность была
объединена, и TLS 1.3 является частью протокола. Это больше не многослойный подход. Одной из немногих частей QUIC-
соединения, которые не зашифрованы, является CID, который помогает направлять трафик.

Промежуточные устройства, такие как балансировщики нагрузки и маршрутизаторы, не знают о содержимом пакета QUIC, и,
таким образом, это означает, что обновления протокола требуются только на конечных точках. Хотя это добавляет
определенную степень гибкости, которая позволяет масштабировать его гораздо легче, чем TCP, это снижает возможности
мониторинга трафика, которые используются брандмауэрами.

Конечные пользователи получают преимущество от HTTP-соединений, которые по своей сути более безопасны, и это еще больше
упрощает процесс соединения. Однако есть некоторые недостатки дополнительной безопасности, предоставляемой QUIC, не
последним из которых является дополнительная нагрузка. Кроме того, проверка пакетов и большая часть другого отслеживания
на уровне соединения, выполняемая промежуточными устройствами, такими как брандмауэры, больше не могут выполняться из-за
шифрования.

Другая проблема, связанная с безопасностью, заключается в том, что QUIC работает только с официальными сертификатами
TLS. Обоснование заключается в том, что если трафик может быть расшифрован промежуточным устройством для целей
мониторинга, то в конечном итоге промежуточные устройства будут иметь пользовательские реализации QUIC. Это сведет на
нет усилия, которые были вложены в создание более масштабируемого протокола в первую очередь. Поэтому, например,
самоподписанные сертификаты не могут быть использованы.

## Ресурсы программирования
Разработчики программного обеспечения, работающие над внедрением QUIC в свои проекты, поймут, что это довольно сложный
алгоритм и что для его внедрения с нуля потребуются значительные усилия. Чтобы помочь в решении этой задачи, существует
множество реализаций QUIC с открытым исходным кодом, доступных для различных сред, языков программирования и ролей.
